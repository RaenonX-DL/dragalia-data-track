"""
[div align=center][size=6][font=微軟正黑體]【龍族】[/font][/size][/div]

[div align=center][color=#FF0000][font=微軟正黑體][size=4]【火】[/size][/font][/color][/div]
[div][table width=95% cellspacing=1 cellpadding=1 border=2 align=center]
[tr]
[td align=center][img=https://gamepedia.cursecdn.com/dragalialost_gamepedia_en/a/ad/200009_01.png width=60][/td]
[/tr]
[tr]
[td align=center][size=4][font=微軟正黑體][url=https://youtu.be/-3Sb2pkUYl8?list=PLwiGaAC1SnWroUk6yMYoW3xTBJZDElawg]連結[/url][/font][/size][/td]
[/tr]
[/table][/div]

[div align=center][color=#3366FF][font=微軟正黑體][size=4]【水】[/size][/font][/color][/div]
[div][table width=95% cellspacing=1 cellpadding=1 border=2 align=center]
[tr]
[td align=center][img=https://gamepedia.cursecdn.com/dragalialost_gamepedia_en/e/ee/210130_01.png width=60][/td]
[/tr]
[tr]
[td align=center][font=微軟正黑體][size=4][url=https://youtu.be/RI8kukQsnwE?list=PLwiGaAC1SnWroUk6yMYoW3xTBJZDElawg]連結[/url][/size][/font][/td]
[/tr]
[/table][/div]

[div align=center][color=#3366FF][font=微軟正黑體][size=4]【風】[/size][/font][/color][/div]
[div][table width=95% cellspacing=1 cellpadding=1 border=2 align=center]
[tr]
[td align=center][img=https://gamepedia.cursecdn.com/dragalialost_gamepedia_en/5/57/210028_01.png width=60][/td]
[/tr]
[tr]
[td align=center][font=微軟正黑體][size=4]連結[/size][/font][/td]
[/tr]
[/table][/div]

[/div][/div][div][div align=center][size=4][color=#339966][font=微軟正黑體]【風】[/font][/color][/size][/div][div][table width=95% cellspacing=1 cellpadding=1 border=2 align=center]
[tr]
[td align=center][font=微軟正黑體][img=https://gamepedia.cursecdn.com/dragalialost_gamepedia_en/5/57/210028_01.png thumbnail=yes width=60][/font][/td]
[/tr]
[tr]
[td align=center][size=4][font=微軟正黑體]連結[/font][/size][/td]
[/tr]
[/table][div align=center][font=微軟正黑體]
[/font][/div][/div][/div][div][div align=center][size=4][color=#FF6600][font=微軟正黑體]【光】[/font][/color][/size][/div][div][table width=95% cellspacing=1 cellpadding=1 border=2 align=center]
[tr]
[td align=center][font=微軟正黑體][img=https://gamepedia.cursecdn.com/dragalialost_gamepedia_en/5/57/210028_01.png width=60][/font][/td]
[/tr]
[tr]
[td align=center][size=4][font=微軟正黑體]連結[/font][/size][/td]
[/tr]
[/table][div align=center][font=微軟正黑體]
[/font][/div][/div][/div][div][div align=center][size=4][color=#512DA8][font=微軟正黑體]【暗】[/font][/color][/size][/div][div align=center][table width=95% cellspacing=1 cellpadding=1 border=2 align=center]
[tr]
[td align=center][font=微軟正黑體][img=https://gamepedia.cursecdn.com/dragalialost_gamepedia_en/8/8f/200017_01.png width=60][/font][/td]
[/tr]
[tr]
[td align=center][size=4][font=微軟正黑體][url=https://youtu.be/xXeXNqcUkuI?list=PLwiGaAC1SnWroUk6yMYoW3xTBJZDElawg]連結[/url][/font][/size][/td]
[/tr]
[/table][/div][/div][div align=center][font=微軟正黑體]
[/font][/div][div align=center][hr][/div][font=微軟正黑體]
[/font][div align=center][color=#000000][size=6][font=微軟正黑體]【角色】[/font][/size][/color][/div][font=微軟正黑體]
[/font][div align=center][color=#FF0000][font=微軟正黑體][size=4]【火[/size][size=4]】[/size][/font][/color][/div][div][table width=95% cellspacing=1 cellpadding=1 border=2 align=center]
[tr]
[td align=center][font=微軟正黑體][img=https://gamepedia.cursecdn.com/dragalialost_gamepedia_en/5/57/210028_01.png width=60][/font][/td]
[/tr]
[tr]
[td align=center][size=4][font=微軟正黑體]連結[/font][/size][/td]
[/tr]
[/table][div align=center][font=微軟正黑體]
[/font][/div][/div][div][div align=center][size=4][color=#3366FF][font=微軟正黑體]【水】[/font][/color][/size][/div][div][table width=95% cellspacing=1 cellpadding=1 border=2 align=center]
[tr]
[td align=center][font=微軟正黑體]
[img=https://gamepedia.cursecdn.com/dragalialost_gamepedia_en/a/a8/110362_01_r05.png width=60][/font][/td]
[td align=center][font=微軟正黑體]
[img=https://gamepedia.cursecdn.com/dragalialost_gamepedia_en/3/3f/100029_03_r05.png width=60][/font][/td]
[/tr]
[tr]
[td align=center][size=4][font=微軟正黑體][url=https://youtu.be/yPmyNQjj4UY?list=PLwiGaAC1SnWocTjTa47NOjSJe-QXf2Ghx]連結[/url][/font][/size][/td]
[td align=center][size=4][font=微軟正黑體][url=https://youtu.be/2BwZuvzHPBo?list=PLwiGaAC1SnWocTjTa47NOjSJe-QXf2Ghx]連結[/url][/font][/size][/td]
[/tr]
[/table][div align=center][font=微軟正黑體]
[/font][/div][/div][/div][div][div align=center][size=4][color=#339966][font=微軟正黑體]【風】[/font][/color][/size][/div][div][table width=95% cellspacing=1 cellpadding=1 border=2 align=center]
[tr]
[td align=center][font=微軟正黑體][img=https://gamepedia.cursecdn.com/dragalialost_gamepedia_en/5/57/210028_01.png width=60][/font][/td]
[/tr]
[tr]
[td align=center][size=4][font=微軟正黑體]連結[/font][/size][/td]
[/tr]
[/table][div align=center][font=微軟正黑體]
[/font][/div][/div][/div][div][div align=center][size=4][color=#FF6600][font=微軟正黑體]【光】[/font][/color][/size][/div][div][table width=95% cellspacing=1 cellpadding=1 border=2 align=center]
[tr]
[td align=center][font=微軟正黑體][img=https://gamepedia.cursecdn.com/dragalialost_gamepedia_en/5/57/210028_01.png width=60][/font][/td]
[/tr]
[tr]
[td align=center][size=4][font=微軟正黑體]連結[/font][/size][/td]
[/tr]
[/table][div align=center][font=微軟正黑體]
[/font][/div][/div][/div][div][div align=center][size=4][color=#512DA8][font=微軟正黑體]【暗】[/font][/color][/size][/div][div align=center][table width=95% cellspacing=1 cellpadding=1 border=2 align=center]
[tr]
[td align=center][font=微軟正黑體][img=https://gamepedia.cursecdn.com/dragalialost_gamepedia_en/5/57/210028_01.png width=60][/font][/td]
[/tr]
[tr]
[td align=center][size=4][font=微軟正黑體]連結[/font][/size][/td]
[/tr]
[/table][/div][/div][div align=center][font=微軟正黑體]
[/font][/div][div align=center]
[/div]
"""
from typing import List, Dict, Tuple
from time import time

from data import NAME_DRAGON, NAME_CHARACTER
from elemtable import generate_elem_table
from element import ElementType


def read_post_head() -> List[str]:
    with open("res/head.txt", encoding="utf-8") as f:
        lines = f.readlines()

    return lines


def read_post_elem_table(fp: str) -> Dict[str, List[Tuple[str, str]]]:
    d: Dict[str, List[Tuple[str, str]]] = {elem: [] for elem, _, _ in ElementType.TO_PROCESS}

    with open(fp, encoding="utf-8") as f:
        for line in f:
            name, element, url_img, url_video = line.split(",", 4)
            d[ElementType.cast(element)].append((url_img, f"{url_video.strip()}"))

    return d


def main():
    _start = time()

    # Read the post head
    print("HEAD - Reading...")
    post_content: List[str] = read_post_head()
    print("HEAD - Reading...completed")

    # ---- Dragon Section ----

    # Append section title
    print("DRAGON - Appending section title...")
    post_content.append(f"[div align=center][size=6][font=微軟正黑體]【{NAME_DRAGON}】[/font][/size][/div]")
    post_content.append(f"[div align=center][/div]\n")
    print("DRAGON - Appending section title...completed")

    # Read the data
    print("DRAGON - Reading data...")
    data: Dict[str, List[Tuple[str, str]]] = read_post_elem_table("res/dragon.csv")
    print("DRAGON - Reading data...completed")

    for elem_key, elem_title, color in ElementType.TO_PROCESS:
        print(f"DRAGON - Generating elemental table ({elem_title})...")
        post_content.extend(generate_elem_table((elem_title, color), data[elem_key]))
        print(f"DRAGON - Generating elemental table ({elem_title})...completed")

    # ---- Character Section ----

    # Append section title
    print("CHARA - Appending section title...")
    post_content.append(f"[div align=center][size=6][font=微軟正黑體]【{NAME_CHARACTER}】[/font][/size][/div]")
    post_content.append(f"[div align=center][/div]\n")
    print("CHARA - Appending section title...completed")

    # Read the data
    print("CHARA - Reading data...completed")
    data: Dict[str, List[Tuple[str, str]]] = read_post_elem_table("res/chara.csv")
    print("CHARA - Reading data...completed")

    for elem_key, elem_title, color in ElementType.TO_PROCESS:
        print(f"CHARA - Generating elemental table ({elem_title})...")
        post_content.extend(generate_elem_table((elem_title, color), data[elem_key]))
        print(f"CHARA - Generating elemental table ({elem_title})...completed")

    with open("output.txt", "w+", encoding="utf-8") as f:
        print(f"OUTPUT - Generating result...")
        f.writelines(post_content)
        print(f"OUTPUT - Generating result...completed.")

    print()
    print(f"Time spent: {(time() - _start) * 1000:.3f} us")


if __name__ == '__main__':
    main()
